<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SICCHA Streaming | Resultados</title>
  <style>
    body{margin:0;font-family:system-ui;background:#070707;color:#fff}
    header{padding:16px;border-bottom:1px solid rgba(255,255,255,.06);background:rgba(0,0,0,.35);backdrop-filter:blur(10px);position:sticky;top:0}
    .wrap{max-width:900px;margin:auto;padding:24px}
    .card{background:rgba(20,20,20,.85);border:1px solid rgba(255,255,255,.10);border-radius:18px;padding:16px;margin:12px 0}
    .small{font-size:12px;color:#b3b3b3}
    .cd{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .box{min-width:90px;text-align:center;padding:10px 12px;border-radius:14px;background:#0f0f0f;border:1px solid rgba(255,255,255,.10)}
    .num{font-size:22px;font-weight:1000}
    .lbl{font-size:11px;color:#b3b3b3}
    .item{display:flex;justify-content:space-between;gap:10px;padding:10px 12px;border-radius:12px;background:#0f0f0f;border:1px solid rgba(255,255,255,.10);margin:8px 0}
    a{color:#fff;text-decoration:none}
  </style>
</head>
<body>
  <header>
    <div style="max-width:900px;margin:auto;display:flex;justify-content:space-between;gap:10px;align-items:center;">
      <div style="font-weight:1000;color:#e50914;">SICCHA Streaming</div>
      <div class="small">
        <a href="index.html">Registro</a> ‚Ä¢ <a href="ruleta.html">Ruleta</a>
      </div>
    </div>
  </header>

  <div class="wrap">
    <h1 style="margin:0 0 6px;">Resultados üéâ</h1>
    <div class="small">Ganadores del sorteo (solo nombres).</div>

    <div class="card">
      <div style="font-weight:900;">Cuenta regresiva (ma√±ana 5:00 PM)</div>
      <div class="cd">
        <div class="box"><div class="num" id="d">--</div><div class="lbl">D√çAS</div></div>
        <div class="box"><div class="num" id="h">--</div><div class="lbl">HORAS</div></div>
        <div class="box"><div class="num" id="m">--</div><div class="lbl">MIN</div></div>
        <div class="box"><div class="num" id="s">--</div><div class="lbl">SEG</div></div>
      </div>
      <div class="small" id="status" style="margin-top:10px;"></div>
    </div>

    <div class="card">
      <div style="font-weight:900;">üèÜ Ganadores</div>
      <div id="list" style="margin-top:10px;"></div>
      <div class="small" id="err" style="margin-top:10px;"></div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const sb = window.supabase.createClient(
      "https://wwfdmvuwjdqzpkeaxgcb.supabase.co",
      "sb_publishable_tFo5T-sC2sq8D9FgKqJKuQ_MC3en0fl"
    );
    const $ = (id)=>document.getElementById(id);

    function maskName(fullName){
      const parts = fullName.trim().split(/\s+/);
      const first = parts[0] || "";
      const last  = parts[1] || "";
      const initial = last ? (last[0].toUpperCase() + ".") : "";
      return (first + (initial ? (" " + initial) : "")).trim();
    }

    // ma√±ana 5:00 PM
    function getTarget(){
  const now = new Date();
  const target = new Date(now);
  target.setHours(17, 0, 0, 0); // hoy 5:00 PM
  return target;
}
   const target = getTarget();

    function tick(){
      const now = new Date();
      let diff = target - now;

      if(diff <= 0){
        $("d").textContent="0"; $("h").textContent="0"; $("m").textContent="0"; $("s").textContent="0";
        $("status").textContent="‚úÖ Ya es hora de resultados.";
        return;
      }

      const sec = Math.floor(diff/1000);
      const days = Math.floor(sec/86400);
      const hrs  = Math.floor((sec%86400)/3600);
      const mins = Math.floor((sec%3600)/60);
      const secs = sec%60;

      $("d").textContent = String(days);
      $("h").textContent = String(hrs).padStart(2,"0");
      $("m").textContent = String(mins).padStart(2,"0");
      $("s").textContent = String(secs).padStart(2,"0");
      $("status").textContent = "‚è≥ Esperando publicaci√≥n de ganadores‚Ä¶";
    }
    setInterval(tick,1000); tick();

    async function loadWinners(){
      $("err").textContent = "";
      const { data, error } = await sb
        .from("winners")
        .select("name,drawn_at")
        .order("drawn_at", { ascending:false });

      if(error){
        $("err").textContent = "‚ùå Error cargando ganadores: " + error.message;
        return;
      }

      if(!data || data.length === 0){
        $("list").innerHTML = `<div class="small">A√∫n no hay ganadores publicados.</div>`;
        return;
      }

      $("list").innerHTML = data.slice(0,5).map((w,i)=>`
        <div class="item">
          <div><b>#${i+1}</b> ${maskName(w.name)}</div>
          <div class="small">${new Date(w.drawn_at).toLocaleString()}</div>
        </div>
      `).join("");
    }

    loadWinners();
    setInterval(loadWinners, 8000);
  </script>
</body>
</html>

