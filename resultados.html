<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SICCHA Streaming | Ganadores</title>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap');

    :root{
      --netflix-red:#E50914;
      --netflix-black:#141414;
      --netflix-dark:#0b0b0b; 
      --gold:#FFD700;
      --green:#22c55e;
      --ice:#B4E4FF;
    }

    *{box-sizing:border-box; margin:0; padding:0;}

    body{
      font-family: 'Netflix Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;
      background: var(--netflix-black);
      color: #fff;
      overflow-x: hidden;
    }

    /* Nieve */
    .snowflake {
      position: fixed;
      top: -10px;
      z-index: 9999;
      user-select: none;
      cursor: default;
      animation: snowfall linear infinite;
      color: rgba(255,255,255,0.8);
      font-size: 1em;
      text-shadow: 0 0 5px rgba(255,255,255,0.8);
      pointer-events:none;
    }
    @keyframes snowfall {
      0% { transform: translateY(0) rotate(0deg); opacity: 1; }
      100% { transform: translateY(100vh) rotate(360deg); opacity: 0.3; }
    }

    /* Header */
    .netflix-header {
      position: fixed;
      top: 0; left: 0; right: 0;
      z-index: 1000;
      background: linear-gradient(180deg, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0) 100%);
      padding: 15px 50px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      transition: background 0.3s;
    }
    .netflix-header.scrolled {
      background: rgba(20,20,20,0.98);
      backdrop-filter: blur(10px);
    }

    .logo {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 2.5rem;
      font-weight: 900;
      color: var(--netflix-red);
      letter-spacing: 3px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
      animation: glow 2s ease-in-out infinite alternate;
    }
    @keyframes glow {
      from { text-shadow: 0 0 10px #E50914, 0 0 20px #E50914; }
      to { text-shadow: 0 0 20px #E50914, 0 0 30px #E50914, 0 0 40px #E50914; }
    }

    .nav-right { display:flex; gap:20px; align-items:center; }
    .nav-btn{
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      padding: 8px 20px;
      border-radius: 4px;
      color:#fff;
      font-size:14px;
      cursor:pointer;
      transition: all .3s;
      font-weight: 500;
    }
    .nav-btn:hover { background: rgba(255,255,255,0.2); transform: scale(1.05); }
    .nav-btn.primary { background: var(--netflix-red); border:none; }
    .nav-btn.primary:hover { background:#f40612; box-shadow: 0 0 20px rgba(229,9,20,0.5); }

    /* Hero */
    .hero-banner {
      position: relative;
      height: 80vh;
      margin-top: 0;
      background: linear-gradient(180deg, rgba(0,0,0,0.3) 0%, #141414 100%),
                  url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100"><rect width="100" height="100" fill="%23222"/><circle cx="20" cy="20" r="2" fill="%23FFD700" opacity="0.3"/><circle cx="60" cy="40" r="2" fill="%23E50914" opacity="0.3"/><circle cx="80" cy="70" r="2" fill="%2322c55e" opacity="0.3"/></svg>');
      display:flex;
      align-items:center;
      padding: 0 50px;
      overflow:hidden;
    }
    .hero-content { max-width: 600px; z-index:2; animation: slideInLeft 1s ease-out; }
    @keyframes slideInLeft { from{opacity:0; transform: translateX(-100px);} to{opacity:1; transform: translateX(0);} }

    .hero-title{
      font-size:4rem;
      font-weight:900;
      margin-bottom:20px;
      text-shadow:3px 3px 6px rgba(0,0,0,0.9);
      line-height:1.1;
    }
    .hero-title .xmas { color: var(--netflix-red); animation:pulse 2s ease-in-out infinite; display:inline-block; }
    @keyframes pulse { 0%,100%{transform:scale(1)} 50%{transform:scale(1.05)} }
    .hero-subtitle { font-size: 1.3rem; color: rgba(255,255,255,0.9); margin-bottom:30px; line-height:1.6; }

    .hero-badges { display:flex; gap:15px; flex-wrap:wrap; margin-bottom:30px; }
    .badge{
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(10px);
      padding: 10px 18px;
      border-radius: 25px;
      font-size:14px;
      border: 1px solid rgba(255,255,255,0.2);
      display:flex;
      align-items:center;
      gap:8px;
    }

    .hero-buttons{ display:flex; gap:15px; }
    .hero-btn{
      padding: 15px 35px;
      font-size: 1.1rem;
      font-weight:700;
      border:none;
      border-radius:6px;
      cursor:pointer;
      transition: all .3s;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .hero-btn.play { background:#fff; color:#000; }
    .hero-btn.play:hover { background: rgba(255,255,255,0.8); transform: scale(1.05); }
    .hero-btn.info { background: rgba(109,109,110,0.7); color:#fff; }
    .hero-btn.info:hover { background: rgba(109,109,110,0.9); }

    .floating-ornament{ position:absolute; animation: float 4s ease-in-out infinite; font-size:3rem; opacity:.6; z-index:1; }
    @keyframes float { 0%,100%{transform: translateY(0) rotate(0)} 50%{transform: translateY(-30px) rotate(10deg)} }
    .ornament-1{ top:15%; right:10%; }
    .ornament-2{ top:40%; right:5%; animation-delay:1s; }
    .ornament-3{ bottom:20%; left:8%; animation-delay:2s; }

    /* Countdown */
    .countdown-section{ padding:60px 50px; background: linear-gradient(180deg, #141414 0%, #0b0b0b 100%); }
    .countdown-container{
      max-width:1200px; margin:0 auto;
      background: linear-gradient(135deg, rgba(229,9,20,0.15) 0%, rgba(255,215,0,0.1) 100%);
      border-radius:15px;
      padding:40px;
      border:2px solid rgba(255,215,0,0.3);
      position:relative;
      overflow:hidden;
    }
    .countdown-container::before{
      content:'';
      position:absolute;
      top:-50%; left:-50%;
      width:200%; height:200%;
      background: radial-gradient(circle, rgba(255,215,0,0.1) 0%, transparent 70%);
      animation: rotate 10s linear infinite;
    }
    @keyframes rotate{ from{transform:rotate(0)} to{transform:rotate(360deg)} }
    .countdown-title{ text-align:center; font-size:2.5rem; margin-bottom:15px; position:relative; z-index:2; }
    .countdown-subtitle{ text-align:center; color:rgba(255,255,255,0.7); margin-bottom:40px; font-size:1.1rem; position:relative; z-index:2; }

    .countdown-display{ display:flex; justify-content:center; gap:30px; flex-wrap:wrap; position:relative; z-index:2; }
    .time-unit{
      text-align:center;
      background: rgba(0,0,0,0.6);
      padding:25px 35px;
      border-radius:12px;
      border:2px solid rgba(255,255,255,0.1);
      min-width:120px;
      position:relative;
      overflow:hidden;
    }
    .time-unit::after{
      content:'';
      position:absolute;
      top:0; left:-100%;
      width:100%; height:100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      animation: shine 3s ease-in-out infinite;
    }
    @keyframes shine{ to{left:100%} }
    .time-number{ font-size:3.5rem; font-weight:900; color: var(--gold); text-shadow: 0 0 20px rgba(255,215,0,0.5); }
    .time-label{ font-size:.9rem; color:rgba(255,255,255,0.6); text-transform:uppercase; letter-spacing:2px; margin-top:10px; }

    /* Winners */
    .winners-section{ padding:60px 50px 100px; background: var(--netflix-dark); }
    .section-title{ font-size:2.5rem; margin-bottom:10px; font-weight:700; }
    .section-subtitle{ color:rgba(255,255,255,0.7); margin-bottom:40px; font-size:1.1rem; }
    .winners-grid{ display:grid; gap:25px; max-width:1400px; margin:0 auto; }

    .winner-card{
      background: linear-gradient(135deg, rgba(229,9,20,0.2) 0%, rgba(20,20,20,0.9) 100%);
      border-radius:12px;
      padding:30px;
      border:2px solid rgba(255,255,255,0.1);
      position:relative;
      overflow:hidden;
      transition: all 0.5s cubic-bezier(0.4,0,0.2,1);
      opacity:0;
      transform: translateY(50px) scale(0.9);
    }
    .winner-card.reveal{ animation: revealCard 0.8s cubic-bezier(0.4,0,0.2,1) forwards; }
    @keyframes revealCard { to{ opacity:1; transform: translateY(0) scale(1); } }
    .winner-card:hover{
      transform: translateY(-10px) scale(1.02);
      border-color: var(--gold);
      box-shadow: 0 20px 60px rgba(255,215,0,0.3);
      opacity:1;
    }

    .winner-card::before{
      content:'üéâ';
      position:absolute;
      top:50%; left:50%;
      font-size:8rem;
      opacity:0;
      transform: translate(-50%,-50%) scale(0);
      pointer-events:none;
    }
    .winner-card.reveal::before{ animation: confettiPop 1s ease-out; }
    @keyframes confettiPop{
      0%{opacity:1; transform:translate(-50%,-50%) scale(0) rotate(0)}
      50%{opacity:.8; transform:translate(-50%,-50%) scale(2) rotate(180deg)}
      100%{opacity:0; transform:translate(-50%,-50%) scale(3) rotate(360deg)}
    }

    .winner-content{ display:flex; align-items:center; gap:25px; position:relative; z-index:2; }
    .winner-rank{
      font-size:4rem;
      font-weight:900;
      color: var(--gold);
      text-shadow: 0 0 30px rgba(255,215,0,0.6);
      min-width:80px;
      text-align:center;
      animation: rankPulse 2s ease-in-out infinite;
    }
    @keyframes rankPulse{ 0%,100%{transform:scale(1)} 50%{transform:scale(1.1)} }
    .winner-rank.top-1{
      font-size:5rem;
      background: linear-gradient(45deg, #FFD700, #FFA500, #FFD700);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
    }

    .winner-info{ flex:1; }
    .winner-name{ font-size:2rem; font-weight:700; margin-bottom:10px; color:#fff; }
    .winner-details{ display:flex; gap:20px; flex-wrap:wrap; font-size:0.95rem; color:rgba(255,255,255,0.7); }
    .winner-detail{ display:flex; align-items:center; gap:8px; }

    .winner-icon{ font-size:3rem; opacity:0.4; position:absolute; right:30px; top:50%; transform: translateY(-50%); }

    @media (max-width: 768px) {
      .netflix-header{ padding:15px 20px; }
      .logo{ font-size:1.8rem; }
      .hero-banner{ height:70vh; padding:0 20px; }
      .hero-title{ font-size:2.5rem; }
      .countdown-section, .winners-section{ padding:40px 20px; }
      .winner-content{ flex-direction:column; text-align:center; }
      .winner-rank{ font-size:3rem; }
    }
  </style>
</head>

<body>
  <header class="netflix-header" id="header">
    <div class="logo">SICCHA</div>
    <div class="nav-right">
      <button class="nav-btn" onclick="location.href='index.html'">‚Üê Inicio</button>
      <button class="nav-btn primary" onclick="location.reload()">üîÑ Actualizar</button>
    </div>
  </header>

  <section class="hero-banner">
    <div class="floating-ornament ornament-1">üéÑ</div>
    <div class="floating-ornament ornament-2">‚≠ê</div>
    <div class="floating-ornament ornament-3">üéÅ</div>

    <div class="hero-content">
      <h1 class="hero-title"><span class="xmas">üéâ Sorteo</span><br>Navide√±o 2025</h1>
      <p class="hero-subtitle">
        5 ganadores se llevar√°n acceso exclusivo a Prime Video por 20 d√≠as.
        ¬°La suerte est√° echada!
      </p>

      <div class="hero-badges">
        <div class="badge">üèÜ 5 Ganadores</div>
        <div class="badge">üé¨ Prime Video</div>
        <div class="badge">‚è±Ô∏è 20 D√≠as</div>
        <div class="badge">‚úÖ 1 Ticket por Celular</div>
      </div>

      <div class="hero-buttons">
        <button class="hero-btn play" onclick="scrollToWinners()">‚ñ∂ Ver Ganadores</button>
        <button class="hero-btn info" onclick="scrollToCountdown()">‚ÑπÔ∏è M√°s Info</button>
      </div>
    </div>
  </section>

  <section class="countdown-section" id="countdown">
    <div class="countdown-container">
      <h2 class="countdown-title">‚è≥ Cuenta Regresiva</h2>
      <p class="countdown-subtitle" id="targetHint">üéÑ El sorteo ser√° hoy a las 5:00 PM</p>

      <div class="countdown-display">
        <div class="time-unit"><div class="time-number" id="d">0</div><div class="time-label">D√≠as</div></div>
        <div class="time-unit"><div class="time-number" id="h">00</div><div class="time-label">Horas</div></div>
        <div class="time-unit"><div class="time-number" id="m">00</div><div class="time-label">Minutos</div></div>
        <div class="time-unit"><div class="time-number" id="s">00</div><div class="time-label">Segundos</div></div>
      </div>

      <p style="text-align:center; margin-top:30px; font-size:1.1rem; position:relative; z-index:2;" id="countText"></p>
    </div>
  </section>

  <section class="winners-section" id="winners">
    <h2 class="section-title">üéä Ganadores Oficiales</h2>
    <p class="section-subtitle" id="state">Cargando ganadores...</p>
    <div class="winners-grid" id="grid"></div>
  </section>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // Supabase (tus datos)
    const sb = window.supabase.createClient(
      "https://wwfdmvuwjdqzpkeaxgcb.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind3ZmRtdnV3amRxenBrZWF4Z2NiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQ5Nzc4MTgsImV4cCI6MjA1MDU1MzgxOH0.tFo5T-sC2sq8D9FgKqJKuQ_MC3en0fl5WvCAKn4RcQs"
    );

    const $ = (id) => document.getElementById(id);
    function pad2(n){ return String(n).padStart(2,"0"); }

    // nieve
    function createSnowflakes() {
      for(let i = 0; i < 50; i++) {
        const s = document.createElement('div');
        s.className = 'snowflake';
        s.textContent = '‚ùÑÔ∏è';
        s.style.left = Math.random() * 100 + '%';
        s.style.animationDuration = (Math.random() * 3 + 5) + 's';
        s.style.animationDelay = Math.random() * 5 + 's';
        s.style.fontSize = (Math.random() * 0.7 + 0.5) + 'em';
        document.body.appendChild(s);
      }
    }
    createSnowflakes();

    // scroll header (FIX: era $('header') pero tu id es "header")
    window.addEventListener('scroll', () => {
      const el = $("header");
      if(!el) return;
      if(window.scrollY > 100) el.classList.add('scrolled');
      else el.classList.remove('scrolled');
    });

    function scrollToWinners(){ $("winners").scrollIntoView({ behavior: 'smooth' }); }
    function scrollToCountdown(){ $("countdown").scrollIntoView({ behavior: 'smooth' }); }

    // countdown hoy 5pm
    function getTargetToday5pm(){
      const now = new Date();
      const t = new Date(now);
      t.setHours(17,0,0,0);
      return t;
    }

    function updateCountdown(){
      const now = new Date();
      const target = getTargetToday5pm();
      let ms = target - now;
      if(ms < 0) ms = 0;

      const totalS = Math.floor(ms/1000);
      const days = Math.floor(totalS/86400);
      const hours = Math.floor((totalS%86400)/3600);
      const mins = Math.floor((totalS%3600)/60);
      const secs = totalS%60;

      $("d").textContent = days;
      $("h").textContent = pad2(hours);
      $("m").textContent = pad2(mins);
      $("s").textContent = pad2(secs);

      $("countText").textContent = ms > 0
        ? `‚è∞ Faltan ${days} d√≠a(s), ${hours} hora(s) y ${mins} minuto(s) para el sorteo`
        : "‚úÖ ¬°El sorteo ya puede publicarse!";

      $("targetHint").textContent = ms > 0
        ? "üéÑ El sorteo ser√° hoy a las 5:00 PM"
        : "üéâ Si ya se eligieron ganadores, aparecer√°n abajo";
    }

    updateCountdown();
    setInterval(updateCountdown, 1000);

    // ---------- GANADORES ----------
    function safeDateLabel(row){
      // Intentamos: drawn_at -> created_at -> nada
      const d = w.created_at ? new Date(w.created_at) : null;
      if(!stamp) return "";
      const d = new Date(stamp);
      if(String(d) === "Invalid Date") return "";
      return d.toLocaleString("es-PE");
    }

    async function loadWinners(){
      const state = $("state");
      const grid = $("grid");
      grid.innerHTML = "";

      // 1) Probamos con drawn_at
      let q = sb.from("winners").select("id,name,ticket,drawn_at,created_at");
      // 2) Orden estable: si hay drawn_at ordena por eso; si no, por created_at
      //    (PostgREST igual puede ordenar aunque haya nulls)
      q = q.order("drawn_at", { ascending: true, nullsFirst: false })
           .order("created_at", { ascending: true, nullsFirst: false });

      const { data, error } = await sb
  .from("winners")
  .select("id, name, ticket, created_at")
  .order("created_at", { ascending: true });

          if(error) {
            state.textContent = "‚ùå Error: " + (error.message || JSON.stringify(error));
            console.error(error);
            return;
          }
          renderWinners(data2);
          return;
        }

        state.textContent = "‚ùå No se pudo cargar ganadores (revisa RLS/columnas).";
        console.error(error);
        return;
      }

      renderWinners(data);
    }

    function renderWinners(data){
      const state = $("state");
      const grid = $("grid");

      if(!data || data.length === 0){
        state.textContent = "‚è≥ A√∫n no hay ganadores. Vuelve despu√©s de las 5:00 PM";
        return;
      }

      state.textContent = "‚úÖ ¬°Los ganadores han sido revelados!";

      const icons = ['üëë','üèÜ','ü•á','üéØ','‚≠ê'];

      data.slice(0,5).forEach((w, idx) => {
        const pos = idx + 1;
        const top = pos === 1;
        const stamp = safeDateLabel(w);

        const card = document.createElement("div");
        card.className = "winner-card";
        card.innerHTML = `
          <div class="winner-content">
            <div class="winner-rank ${top ? "top-1" : ""}">${pos}</div>
            <div class="winner-info">
              <div class="winner-name">${w.name || "Ganador"}</div>
              <div class="winner-details">
                <div class="winner-detail">üé´ Ticket: <b>${w.ticket || "‚Äî"}</b></div>
                ${stamp ? `<div class="winner-detail">üïí ${stamp}</div>` : ""}
              </div>
            </div>
            <div class="winner-icon">${icons[idx] || "üéÅ"}</div>
          </div>
        `;

        grid.appendChild(card);

        // reveal anim con delay
        setTimeout(() => card.classList.add("reveal"), 350 + idx * 250);
      });
    }

    loadWinners();
  </script>
</body>
</html>

