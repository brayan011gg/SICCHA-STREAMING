<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SICCHA Streaming | Ganadores</title>

  <style>
    :root{
      --bg:#030b17;
      --panel: rgba(12, 22, 45, .78);
      --border: rgba(255,255,255,.10);
      --prime:#00A8E1;
      --prime2:#2bd4ff;
      --txt:#e7f1ff;
      --muted: rgba(231,241,255,.72);
      --good:#22c55e;
      --shadow: 0 18px 70px rgba(0,0,0,.55);
      --christmas:#e50914;
      --gold:#ffd166;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto;
      color:var(--txt);
      background:
        radial-gradient(1200px 600px at 15% 8%, rgba(0,168,225,.22), transparent 55%),
        radial-gradient(900px 500px at 80% 0%, rgba(229,9,20,.18), transparent 55%),
        linear-gradient(180deg, #020713, #06122a 40%, #020713);
      overflow-x:hidden;
    }

    /* Falling snow */
    .snow{
      pointer-events:none;
      position:fixed; inset:0; z-index:0;
      background-image:
        radial-gradient(2px 2px at 20px 30px, rgba(255,255,255,.9), transparent 60%),
        radial-gradient(2px 2px at 140px 90px, rgba(255,255,255,.7), transparent 60%),
        radial-gradient(1px 1px at 60px 170px, rgba(255,255,255,.9), transparent 60%),
        radial-gradient(1px 1px at 220px 220px, rgba(255,255,255,.65), transparent 60%),
        radial-gradient(2px 2px at 260px 140px, rgba(255,255,255,.75), transparent 60%);
      background-size: 280px 280px;
      animation: snowMove 9s linear infinite;
      opacity:.33;
    }
    @keyframes snowMove{
      from{transform: translateY(-40px)}
      to{transform: translateY(40px)}
    }

    /* Twinkle stars overlay */
    .twinkle{
      pointer-events:none;
      position:fixed; inset:0; z-index:0;
      background-image:
        radial-gradient(2px 2px at 12% 18%, rgba(255,255,255,.35), transparent 60%),
        radial-gradient(2px 2px at 70% 22%, rgba(255,255,255,.25), transparent 60%),
        radial-gradient(2px 2px at 32% 62%, rgba(255,255,255,.28), transparent 60%),
        radial-gradient(1px 1px at 86% 58%, rgba(255,255,255,.22), transparent 60%),
        radial-gradient(1px 1px at 54% 44%, rgba(255,255,255,.18), transparent 60%);
      animation: tw 3.8s ease-in-out infinite alternate;
      opacity:.45;
    }
    @keyframes tw{
      from{opacity:.25; filter: blur(0px);}
      to{opacity:.55; filter: blur(0.4px);}
    }

    /* Xmas lights string */
    .lightsWrap{
      position:fixed;
      top:0; left:0; right:0;
      z-index:10;
      pointer-events:none;
      height:54px;
    }
    .wire{
      position:absolute; left:-2%; right:-2%; top:22px;
      height:2px;
      background: rgba(255,255,255,.16);
      border-radius:999px;
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
      transform: rotate(-1deg);
    }
    .bulbs{
      position:absolute; left:0; right:0; top:12px;
      display:flex; justify-content:center; gap:16px; flex-wrap:wrap;
      padding:0 10px;
    }
    .bulb{
      width:12px; height:16px;
      border-radius: 8px 8px 10px 10px;
      opacity:.9;
      box-shadow: 0 8px 16px rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.12);
      animation: blink 1.8s infinite;
    }
    .bulb:nth-child(4n+1){ background: rgba(229,9,20,.95); animation-delay: .1s;}
    .bulb:nth-child(4n+2){ background: rgba(34,197,94,.95); animation-delay: .4s;}
    .bulb:nth-child(4n+3){ background: rgba(0,168,225,.95); animation-delay: .7s;}
    .bulb:nth-child(4n+4){ background: rgba(255,209,102,.95); animation-delay: 1.0s;}
    @keyframes blink{
      0%, 100%{ filter: brightness(0.65); transform: translateY(0); }
      50%{ filter: brightness(1.35); transform: translateY(2px); }
    }

    /* Decorative trees */
    .tree{
      position:fixed;
      z-index:2;
      font-size:64px;
      opacity:.22;
      filter: drop-shadow(0 18px 40px rgba(0,0,0,.55));
      pointer-events:none;
    }
    .tree.left{left:12px; bottom:12px; transform: rotate(-6deg);}
    .tree.right{right:12px; bottom:12px; transform: rotate(6deg);}

    header{
      position:sticky; top:0; z-index:6;
      backdrop-filter: blur(10px);
      background: rgba(0,0,0,.25);
      border-bottom: 1px solid rgba(255,255,255,.06);
      margin-top:54px; /* space for lights */
    }
    .topbar{
      max-width:1100px; margin:0 auto; padding:16px 18px;
      display:flex; align-items:center; justify-content:space-between; gap:12px;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      font-weight:900; letter-spacing:.4px;
    }
    .brand .ring{
      width:12px;height:12px;border-radius:999px;
      background: radial-gradient(circle at 30% 30%, #fff, var(--prime));
      box-shadow: 0 0 18px rgba(0,168,225,.55);
    }
    .brand span{color:var(--prime)}
    .pill{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      padding:8px 12px;
      border-radius:999px;
      color:rgba(231,241,255,.8);
      font-size:12px;
      white-space:nowrap;
      display:flex; align-items:center; gap:8px;
    }

    .wrap{max-width:1100px; margin:0 auto; padding:26px 18px 56px; position:relative; z-index:3;}
    .hero{
      border:1px solid rgba(255,255,255,.10);
      border-radius:26px;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(0,0,0,.18));
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .heroTop{
      padding:26px 22px 18px;
      background:
        radial-gradient(900px 320px at 15% 0%, rgba(0,168,225,.28), transparent 65%),
        radial-gradient(900px 320px at 85% 0%, rgba(229,9,20,.18), transparent 65%),
        linear-gradient(180deg, rgba(255,255,255,.05), transparent);
      border-bottom:1px solid rgba(255,255,255,.07);
    }
    h1{margin:0 0 8px; font-size:34px; line-height:1.05;}
    .sub{margin:0; color:var(--muted); line-height:1.45; font-size:14px;}
    .row{
      display:flex; flex-wrap:wrap; gap:10px;
      margin-top:14px;
      align-items:center;
    }
    .badge{
      font-size:12px; color:rgba(231,241,255,.8);
      padding:8px 10px; border-radius:999px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      display:flex; align-items:center; gap:8px;
    }
    .btn{
      cursor:pointer;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.07);
      color:var(--txt);
      padding:10px 12px;
      font-weight:900;
    }
    .btnPrimary{
      border:0;
      background: linear-gradient(90deg, var(--prime), var(--prime2));
      color:#001018;
      box-shadow: 0 12px 30px rgba(0,168,225,.18);
    }

    .content{ padding:18px 22px 22px; }

    .state{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.20);
      border-radius:18px;
      padding:14px 14px;
      color:var(--muted);
      font-size:13px;
      line-height:1.4;
    }
    .state.good{
      border-color: rgba(34,197,94,.25);
      background: rgba(34,197,94,.10);
      color: rgba(231,255,245,.92);
    }

    /* Countdown */
    .countBox{
      margin-top:12px;
      border:1px solid rgba(255,255,255,.10);
      border-radius:18px;
      background:
        radial-gradient(900px 260px at 0% 0%, rgba(229,9,20,.14), rgba(0,0,0,.12)),
        radial-gradient(900px 260px at 100% 0%, rgba(0,168,225,.16), rgba(0,0,0,.12));
      padding:14px 14px;
      display:flex;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .countTitle{ font-weight:1000; letter-spacing:.2px; }
    .countHint{
      color:var(--muted);
      font-size:12px;
      margin-top:4px;
      line-height:1.35;
    }
    .clock{ display:flex; gap:8px; flex-wrap:wrap; }
    .tile{
      min-width:78px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      padding:10px 10px;
      text-align:center;
      position:relative;
      overflow:hidden;
    }
    .tile::after{
      content:"";
      position:absolute; inset:-40px -60px;
      background: linear-gradient(120deg, transparent, rgba(255,255,255,.10), transparent);
      transform: translateX(-50%);
      animation: shine 3.2s ease-in-out infinite;
      opacity:.45;
    }
    @keyframes shine{
      0%{transform: translateX(-60%) rotate(10deg);}
      50%{transform: translateX(10%) rotate(10deg);}
      100%{transform: translateX(80%) rotate(10deg);}
    }
    .num{ font-size:22px; font-weight:1000; position:relative; z-index:1; }
    .lab{ margin-top:2px; font-size:11px; color:var(--muted); position:relative; z-index:1; }
    .countText{
      font-size:13px;
      color:rgba(231,241,255,.9);
      font-weight:800;
      margin-top:6px;
    }

    /* Winners list */
    .grid{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap:12px;
      margin-top:14px;
    }
    @media (max-width:840px){ .grid{grid-template-columns:1fr;} }

    .winnerCard{
      position:relative;
      border-radius:22px;
      border:1px solid rgba(255,255,255,.10);
      background:
        radial-gradient(700px 220px at 0% 0%, rgba(0,168,225,.18), rgba(0,0,0,.15)),
        radial-gradient(700px 220px at 100% 0%, rgba(229,9,20,.14), rgba(0,0,0,.15));
      box-shadow: 0 14px 40px rgba(0,0,0,.35);
      overflow:hidden;
      padding:16px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      transform: translateY(14px);
      opacity:0;
    }

    /* Animation reveal */
    .winnerCard.reveal{
      animation: popIn .55s cubic-bezier(.2,.9,.2,1) forwards;
    }
    @keyframes popIn{
      from{ opacity:0; transform: translateY(18px) scale(.98); filter: blur(.5px); }
      to{ opacity:1; transform: translateY(0) scale(1); filter: blur(0); }
    }

    .left{
      display:flex; align-items:center; gap:12px;
      min-width:0;
    }
    .rank{
      width:46px; height:46px;
      border-radius:16px;
      display:grid; place-items:center;
      background: rgba(255,255,255,.07);
      border:1px solid rgba(255,255,255,.12);
      font-weight:1000;
      letter-spacing:.2px;
    }
    .rank.top{
      background: linear-gradient(180deg, rgba(255,209,102,.28), rgba(255,255,255,.06));
      border-color: rgba(255,209,102,.25);
    }
    .name{
      font-weight:1000;
      font-size:18px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width:520px;
    }
    .meta{
      margin-top:2px;
      color:var(--muted);
      font-size:12px;
      display:flex; gap:10px; flex-wrap:wrap;
    }
    .spark{
      position:absolute;
      right:-30px; top:-30px;
      width:160px; height:160px;
      background: radial-gradient(circle at 30% 30%, rgba(43,212,255,.55), transparent 60%);
      opacity:.28;
      transform: rotate(10deg);
    }
    /* tiny ornaments */
    .ornaments{
      position:absolute;
      left:12px; top:10px;
      display:flex; gap:6px;
      opacity:.9;
    }
    .ball{
      width:10px;height:10px;border-radius:999px;
      border:1px solid rgba(255,255,255,.18);
      box-shadow: 0 8px 14px rgba(0,0,0,.30);
      animation: swing 2.2s ease-in-out infinite;
      transform-origin: 50% -10px;
    }
    .ball.red{background: rgba(229,9,20,.95)}
    .ball.green{background: rgba(34,197,94,.95); animation-delay:.25s}
    .ball.blue{background: rgba(0,168,225,.95); animation-delay:.45s}
    .ball.gold{background: rgba(255,209,102,.95); animation-delay:.65s}
    @keyframes swing{
      0%,100%{transform: rotate(-6deg)}
      50%{transform: rotate(6deg)}
    }

    footer{
      max-width:1100px; margin:18px auto 0; padding:0 18px 20px;
      color: rgba(231,241,255,.35);
      font-size:12px;
      text-align:center;
      position:relative; z-index:3;
    }
    .note{ margin-top:10px; color: rgba(231,241,255,.55); }
  </style>
</head>

<body>
  <!-- Decorations -->
  <div class="lightsWrap">
    <div class="wire"></div>
    <div class="bulbs">
      <!-- Enough bulbs to look full -->
      <div class="bulb"></div><div class="bulb"></div><div class="bulb"></div><div class="bulb"></div>
      <div class="bulb"></div><div class="bulb"></div><div class="bulb"></div><div class="bulb"></div>
      <div class="bulb"></div><div class="bulb"></div><div class="bulb"></div><div class="bulb"></div>
      <div class="bulb"></div><div class="bulb"></div><div class="bulb"></div><div class="bulb"></div>
      <div class="bulb"></div><div class="bulb"></div><div class="bulb"></div><div class="bulb"></div>
    </div>
  </div>

  <div class="snow"></div>
  <div class="twinkle"></div>
  <div class="tree left">üéÑ</div>
  <div class="tree right">üéÑ</div>

  <header>
    <div class="topbar">
      <div class="brand"><div class="ring"></div> SICCHA <span>Streaming</span></div>
      <div class="pill">üéÑ Ganadores ‚Ä¢ Prime Video ‚Ä¢ 20 d√≠as</div>
    </div>
  </header>

  <main class="wrap">
    <section class="hero">
      <div class="heroTop">
        <h1>üéâ Ganadores del sorteo</h1>
        <p class="sub">
          Si el sorteo a√∫n no ocurre, ver√°s la <b>cuenta regresiva</b>. Despu√©s del sorteo, se publican los <b>5 ganadores</b>.
        </p>

        <div class="row">
          <div class="badge">üèÜ 5 perfiles ‚Ä¢ Prime Video</div>
          <div class="badge">‚úÖ 1 ticket por celular</div>
          <div class="badge">üéÅ Sorteo navide√±o</div>

          <button class="btn" onclick="location.href='index.html'">‚¨Ö Volver</button>
          <button class="btn btnPrimary" onclick="location.reload()">üîÑ Actualizar</button>
        </div>
      </div>

      <div class="content">

        <!-- Countdown -->
        <div class="countBox">
          <div>
            <div class="countTitle">‚è≥ Cuenta regresiva</div>
            <div class="countHint" id="targetHint">üéÑ El sorteo ser√° en unas horas.</div>
            <div class="countText" id="countText"></div>
          </div>

          <div class="clock">
            <div class="tile">
              <div class="num" id="d">0</div>
              <div class="lab">D√≠as</div>
            </div>
            <div class="tile">
              <div class="num" id="h">00</div>
              <div class="lab">Horas</div>
            </div>
            <div class="tile">
              <div class="num" id="m">00</div>
              <div class="lab">Min</div>
            </div>
            <div class="tile">
              <div class="num" id="s">00</div>
              <div class="lab">Seg</div>
            </div>
          </div>
        </div>

        <div id="state" class="state" style="margin-top:12px;">Cargando ganadores...</div>

        <div id="grid" class="grid" style="display:none;"></div>

        <div class="note">
          üìå Regla: si un n√∫mero ganador <b>no est√° en el grupo de WhatsApp</b> o no valida con su ticket, se elige a otro ganador.
        </div>
      </div>
    </section>
  </main>

  <footer>
    SICCHA Streaming ¬© 2025 ‚Ä¢ Estilo inspirado en Prime Video (no afiliado).
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // ‚úÖ Tus datos de Supabase
    const sb = window.supabase.createClient(
      "https://wwfdmvuwjdqzpkeaxgcb.supabase.co",
      "sb_publishable_tFo5T-sC2sq8D9FgKqJKuQ_MC3en0fl"
    );

    const $ = (id) => document.getElementById(id);
    function esc(s){ return String(s ?? "").replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

    // ====== COUNTDOWN (HOY 5:00 PM) ======
    function getTargetToday5pm(){
      const now = new Date();
      const t = new Date(now);
      t.setHours(17,0,0,0); // 5:00 PM
      return t;
    }
    function pad2(n){ return String(n).padStart(2,"0"); }

    function updateCountdown(){
      const now = new Date();
      const target = getTargetToday5pm();
      let ms = target - now;

      if(ms < 0) ms = 0;

      const s = Math.floor(ms/1000);
      const days = Math.floor(s/86400);
      const hours = Math.floor((s%86400)/3600);
      const mins = Math.floor((s%3600)/60);
      const secs = s%60;

      $("d").textContent = days;
      $("h").textContent = pad2(hours);
      $("m").textContent = pad2(mins);
      $("s").textContent = pad2(secs);

      if(ms > 0){
        $("countText").textContent = `Faltan ${days} d√≠a(s), ${hours} hora(s) y ${mins} min para las 5:00 PM.`;
        $("targetHint").textContent = "üéÑ El sorteo ser√° en unas horas.";
      }else{
        $("countText").textContent = "‚úÖ El sorteo ya puede publicarse / ya ocurri√≥.";
        $("targetHint").textContent = "üéâ Si ya se eligieron ganadores, aparecer√°n aqu√≠.";
      }
    }
    updateCountdown();
    setInterval(updateCountdown, 1000);

    // ====== WINNERS LOAD + REVEAL ANIMATION ======
    function clearGrid(){
      $("grid").innerHTML = "";
    }

    async function loadWinners(){
      $("grid").style.display = "none";
      clearGrid();
      $("state").className = "state";
      $("state").textContent = "Cargando ganadores...";

      // Ajusta si tus columnas tienen otros nombres:
      const { data, error } = await sb
        .from("winners")
        .select("id, name, position, created_at")
        .order("position", { ascending: true });

      if(error){
        $("state").textContent = "‚ùå No se pudo cargar ganadores. Revisa policies (SELECT para anon) o la tabla winners.";
        return;
      }

      if(!data || data.length === 0){
        $("state").textContent = "‚è≥ A√∫n no hay ganadores publicados. Revisa la cuenta regresiva y vuelve m√°s tarde.";
        return;
      }

      $("state").className = "state good";
      $("state").textContent = "‚úÖ Ganadores publicados. ¬°Felicidades a los 5!";
      $("grid").style.display = "grid";

      // Reveal secuencial (uno por uno)
      data.forEach((w, idx) => {
        const pos = w.position ?? (idx+1);
        const isTop = pos === 1;

        const d = w.created_at ? new Date(w.created_at) : null;
        const stamp = d ? d.toLocaleString("es-PE") : "";

        const card = document.createElement("div");
        card.className = "winnerCard";

        card.innerHTML = `
          <div class="spark"></div>
          <div class="ornaments">
            <div class="ball red"></div>
            <div class="ball green"></div>
            <div class="ball blue"></div>
            <div class="ball gold"></div>
          </div>

          <div class="left">
            <div class="rank ${isTop ? "top" : ""}">#${esc(pos)}</div>
            <div style="min-width:0;">
              <div class="name">${esc(w.name || "Ganador")}</div>
              <div class="meta">
                <span>üéÅ Premio: Prime Video (20 d√≠as)</span>
                ${stamp ? `<span>üïí ${esc(stamp)}</span>` : ``}
              </div>
            </div>
          </div>

          <div style="text-align:right; color:rgba(231,241,255,.82); font-size:12px;">
            ${isTop ? "üëë TOP 1" : "üèÖ"}
          </div>
        `;

        $("grid").appendChild(card);

        // animaci√≥n escalonada
        setTimeout(() => {
          card.classList.add("reveal");
        }, 200 + idx * 260);
      });
    }

    loadWinners();
    // auto refresco por si publicas ganadores mientras la gente mira
    setInterval(loadWinners, 15000);
  </script>
</body>
</html>
